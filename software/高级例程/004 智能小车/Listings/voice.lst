C51 COMPILER V9.01   VOICE                                                                 07/09/2019 13:08:35 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE VOICE
OBJECT MODULE PLACED IN voice.obj
COMPILER INVOKED BY: D:\cx\C51\BIN\C51.EXE voice\voice.c BROWSE DEBUG OBJECTEXTEND PRINT(.\voice.lst) OBJECT(voice.obj)

line level    source

   1          /*********************************************************************************************************
   2          *名称：voice.c
   3          *功能：语音功能所用到的函数
   4          创建时间：2019/7/8
   5          修改时间：2019/7/8
   6          作者：黄彦钊
   7          *********************************************************************************************************/
   8          #include <STC12C5A.H>   
   9          #include <stdio.h>        
  10          #include "voice.h"         
  11          #include "delay/delay.h"
  12          #include "config.h"
  13          
  14          #define HEADLEN       5  //数据包头的长度
  15          #define BKM_OFFSET    4  //背景音乐命令偏移
  16          #define LEN_OFFSET    2  //长度字节的偏移量（一般不会超过255字节，因此只使用1字节长度）
  17          #define BKM_MAX      15  //背景音乐数量
  18          
  19          //数据包头（0xFD + 2字节长度 + 1字节命令字 + 1字节命令参数)
  20          uchar head[HEADLEN] = {0xfd,0x00,0x00,0x01,0x00};
  21          uchar nBkm = 0x00;       
  22            
  23          /*******************************************************************************
  24          * 函 数 名         : UART_Init
  25          * 函数功能                 : 串口初始化
  26          *******************************************************************************/
  27          void UART_Init(void)
  28          {
  29   1              SCON=0xD8 ;   
  30   1              TMOD=0x20 ;
  31   1              PCON=0x00 ;      
  32   1              TH1 = 0xFD;      //晶振为11.059MHZ时，设定串口波特率为9600bit/s，方式3 
  33   1              //TH1=0xFA ;   //晶振为22.1184MHZ时，设定串口波特率为9600bit/s，方式3  
  34   1              TR1=1;  
  35   1      }
  36          /*******************************************************************************
  37          * 函 数 名         : SendChar
  38          * 函数功能                 : 串口发送数据
  39          *******************************************************************************/
  40          void SendChar(uchar n)
  41          {
  42   1              SBUF = n;
  43   1              while (TI==0);//发送数据
  44   1              TI=0;
  45   1      }       
  46          /*******************************************************************************
  47          * 函 数 名         : Speech
  48          * 函数功能                 : 发声程序
  49          *******************************************************************************/
  50          void Speech(uchar *buf)
  51          {
  52   1              uchar i = 0;          //循环计数变量
  53   1              uchar xor = 0x00;     //校验码初始化
  54   1              uchar ch = 0x00;
  55   1          uchar len = 0x00;
C51 COMPILER V9.01   VOICE                                                                 07/09/2019 13:08:35 PAGE 2   

  56   1      
  57   1          while(buf[len++]);
  58   1      
  59   1              //发送数据包头(0xFD + 2字节长度 + 1字节命令字 + 1字节命令参数)
  60   1              for(i = 0; i < HEADLEN; i++)
  61   1              {
  62   2                      if(i == BKM_OFFSET)
  63   2                              ch = nBkm << 3; //写入背景音乐
  64   2                      else if(i == LEN_OFFSET)
  65   2                              ch = len + 3;
  66   2                      else
  67   2                              ch = head[i];
  68   2      
  69   2                      xor ^= ch;
  70   2                      SendChar(ch);
  71   2                      delay_ms(1);
  72   2              }
  73   1      
  74   1              //发送文字内容
  75   1              for(i = 0; i < len; i++)
  76   1              {
  77   2                      xor ^= buf[i];
  78   2                      SendChar(buf[i]);
  79   2                      delay_ms(1);
  80   2              }
  81   1      
  82   1              SendChar(xor);         //发送校验位
  83   1      
  84   1              delay_ms(50);
  85   1              //while(BUSY);         //等待合成结束
  86   1              delay_ms(50);
  87   1      }        
  88          /*******************************************************************************
  89          * 函 数 名         : one
  90          * 函数功能                 : 报位置为花都广场
  91          *******************************************************************************/
  92          void one()
  93          {  
  94   1              TR0=0; 
  95   1              Speech("现在的位置是花都广场");
  96   1              delay_ms(20000);
  97   1              TR0=1;
  98   1              //delay_ms(5000);
  99   1                      
 100   1      }        
 101          /*******************************************************************************
 102          * 函 数 名         : two
 103          * 函数功能                 : 报位置为白云山
 104          *******************************************************************************/
 105          void two()
 106          {  
 107   1              TR0=0;
 108   1              Speech("现在的位置是白云山");
 109   1              delay_ms(20000);
 110   1              TR0=1;
 111   1              //delay_ms(5000);
 112   1                      
 113   1      }       
 114          /*******************************************************************************
 115          * 函 数 名         : third
 116          * 函数功能                 : 报位置为华南植物园
 117          *******************************************************************************/
C51 COMPILER V9.01   VOICE                                                                 07/09/2019 13:08:35 PAGE 3   

 118          void third()
 119          {  
 120   1              TR0=0;
 121   1              Speech("现在的位置是华南植物园");
 122   1              delay_ms(25000);
 123   1              TR0=1;
 124   1              //delay_ms(5000);
 125   1                      
 126   1      }  
 127          /*******************************************************************************
 128          * 函 数 名         : four
 129          * 函数功能                 : 报位置为广东省博物馆
 130          *******************************************************************************/
 131          void four()
 132          {  
 133   1              TR0=0; 
 134   1              Speech("现在的位置是广东省博物馆");
 135   1              delay_ms(30000);
 136   1              TR0=1;
 137   1              //delay_ms(5000);
 138   1                      
 139   1      }  
 140          /*******************************************************************************
 141          * 函 数 名         : five
 142          * 函数功能                 : 报位置为广州塔
 143          *******************************************************************************/
 144          void five()
 145          {  
 146   1              TR0=0; 
 147   1              Speech("现在的位置是广州塔");
 148   1              delay_ms(22000);
 149   1              TR0=1;
 150   1              //delay_ms(5000);
 151   1                      
 152   1      }
 153          /*******************************************************************************
 154          * 函 数 名         : six
 155          * 函数功能                 : 报位置为中山纪念馆
 156          *******************************************************************************/
 157          void six()
 158          {
 159   1              TR0=0; 
 160   1              Speech("现在的位置是中山纪念馆");
 161   1              delay_ms(32000);
 162   1              TR0=1;  
 163   1      }
 164          /*******************************************************************************
 165          * 函 数 名         : seven
 166          * 函数功能                 : 报位置为黄埔军校
 167          *******************************************************************************/
 168          void seven()
 169          {
 170   1              TR0=0; 
 171   1              Speech("现在的位置是黄埔军校");
 172   1              delay_ms(20000);
 173   1              TR0=1;
 174   1      }
 175          /*******************************************************************************
 176          * 函 数 名         : eight
 177          * 函数功能                 : 报位置为长隆动物园
 178          *******************************************************************************/
 179          void eight()
C51 COMPILER V9.01   VOICE                                                                 07/09/2019 13:08:35 PAGE 4   

 180          {
 181   1              TR0=0; 
 182   1              Speech("现在的位置是长隆动物园");
 183   1              delay_ms(32000);
 184   1              TR0=1;
 185   1      }
 186          /*******************************************************************************
 187          * 函 数 名         : nine
 188          * 函数功能                 : 报位置为上下九步行街
 189          *******************************************************************************/
 190          void nine()
 191          {
 192   1              TR0=0; 
 193   1              Speech("现在的位置是上下九步行街");
 194   1              delay_ms(42000);
 195   1              TR0=1;
 196   1      }
 197          /*******************************************************************************
 198          * 函 数 名         : ten
 199          * 函数功能                 : 报位置为流溪河国家森林公园
 200          *******************************************************************************/
 201          void ten()
 202          {
 203   1              TR0=0; 
 204   1              Speech("现在的位置是流溪河国家森林公园");
 205   1              delay_ms(52000);
 206   1              TR0=1;
 207   1      }
 208          /*******************************************************************************
 209          * 函 数 名         : eleven
 210          * 函数功能                 : 报位置为华广
 211          *******************************************************************************/
 212          void eleven()
 213          {
 214   1              TR0=0; 
 215   1              Speech("现在的位置是华广");
 216   1              delay_ms(20000);
 217   1              TR0=1;
 218   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    414    ----
   CONSTANT SIZE    =    247    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
