C51 COMPILER V9.01   PWM                                                                   07/09/2019 13:08:34 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE PWM
OBJECT MODULE PLACED IN pwm.obj
COMPILER INVOKED BY: D:\cx\C51\BIN\C51.EXE pwm\pwm.c BROWSE DEBUG OBJECTEXTEND PRINT(.\pwm.lst) OBJECT(pwm.obj)

line level    source

   1          /*********************************************************************************************************
   2          *名称：pwm.c
   3          *功能：pwm调速所用到的函数
   4          创建时间：2019/7/8
   5          修改时间：2019/7/8
   6          作者：黄彦钊
   7          *********************************************************************************************************/
   8          
   9          #include <STC12C5A.H>
  10          #include "pwm.h"           
  11          #include "config.h"
  12          sbit ENB1=P2^0;       //从后面看，控制左前电机的占空比
  13          sbit ENA1=P2^5;       //从后面看，控制左后电机的占空比
  14          int  left;        //左转速率
  15          int  right;       //右转速率
  16          int  t1;          //pwm值         //小车停止    */
  17                    
  18          /*******************************************************************************
  19          * 函 数 名         : Time1
  20          * 函数功能                 : 串口初始化
  21          *******************************************************************************/
  22          void Time1()  
  23          { 
  24   1               SCON=0x50;          //设定串口工作方式
  25   1           PCON=0x00;          //波特率不倍增
  26   1               EA=1;
  27   1               TMOD|=0x02;
  28   1               TR0=1;
  29   1               ET0=1;
  30   1               TH0=(65535-100)/256;
  31   1               TL0=(65535-100)%256; 
  32   1      }       
  33          /*******************************************************************************
  34          * 函 数 名         : goahead
  35          * 函数功能                 : 小车直走
  36          *******************************************************************************/
  37          void goahead()
  38          {
  39   1           left=37;
  40   1               right=38;
  41   1               left1=1;
  42   1               left2=0;
  43   1               right1=1;
  44   1               right2=0;
  45   1      }       
  46          /*******************************************************************************
  47          * 函 数 名         : goahead1
  48          * 函数功能                 : 小车直走方式2
  49          *******************************************************************************/
  50          void goahead1()
  51          {
  52   1           left=35;
  53   1               right=36;
  54   1               left1=1;
  55   1               left2=0;
C51 COMPILER V9.01   PWM                                                                   07/09/2019 13:08:34 PAGE 2   

  56   1               right1=1;
  57   1               right2=0;
  58   1      } 
  59          /*******************************************************************************
  60          * 函 数 名         : turnleft
  61          * 函数功能                 : 左转
  62          *******************************************************************************/
  63          void turnleft()          
  64          {
  65   1           left=0;
  66   1               right=39;
  67   1               left1=0;
  68   1               left2=1;
  69   1               right1=1;
  70   1               right2=0;
  71   1      }
  72          /*******************************************************************************
  73          * 函 数 名         : turnright
  74          * 函数功能                 : 右转
  75          *******************************************************************************/
  76          void turnright()
  77          {
  78   1           left=37;
  79   1               right=0;
  80   1               left1=1;
  81   1               left2=0;
  82   1               right1=0;
  83   1               right2=1;
  84   1      }
  85          /*******************************************************************************
  86          * 函 数 名         : turnback1
  87          * 函数功能                 : 向右后转
  88          *******************************************************************************/
  89          void turnback1()
  90          {
  91   1           left=40;
  92   1               right=57;
  93   1               left1=1;
  94   1               left2=0;
  95   1               right1=0;
  96   1               right2=1;
  97   1      }       
  98          /*******************************************************************************
  99          * 函 数 名         : turnback2
 100          * 函数功能                 : 向右后转方式2
 101          *******************************************************************************/
 102          void turnback2()//向左后转
 103          {
 104   1           left=54;
 105   1               right=41;
 106   1               left1=0;
 107   1               left2=1;
 108   1               right1=1;
 109   1               right2=0;
 110   1      }               
 111          /*******************************************************************************
 112          * 函 数 名         : turnback3
 113          * 函数功能                 : 向右后转方式3
 114          *******************************************************************************/
 115          void turnback3()//
 116          {
 117   1           left=40;
C51 COMPILER V9.01   PWM                                                                   07/09/2019 13:08:34 PAGE 3   

 118   1               right=57;
 119   1               left1=1;
 120   1               left2=0;
 121   1               right1=0;
 122   1               right2=1;
 123   1      }  
 124          /*******************************************************************************
 125          * 函 数 名         : offsetleft
 126          * 函数功能                 : 向左偏移
 127          *******************************************************************************/
 128          void offsetleft()       
 129          {
 130   1               left=0;
 131   1               right=41;
 132   1               left1=1;
 133   1               left2=0;
 134   1               right1=1;
 135   1               right2=0;
 136   1      } 
 137          /*******************************************************************************
 138          * 函 数 名         : offsetleft1
 139          * 函数功能                 : 向左偏移方式2
 140          *******************************************************************************/
 141          void offsetleft1()      
 142          {
 143   1               left=0;
 144   1               right=37;
 145   1               left1=1;
 146   1               left2=0;
 147   1               right1=1;
 148   1               right2=0;
 149   1      }
 150          /*******************************************************************************
 151          * 函 数 名         : offsetright
 152          * 函数功能                 : 向右偏移
 153          *******************************************************************************/
 154          void offsetright()      
 155          {
 156   1           left=42;
 157   1               right=0;
 158   1               left1=1;
 159   1               left2=0;
 160   1               right1=1;
 161   1               right2=0;
 162   1      } 
 163          /*******************************************************************************
 164          * 函 数 名         : offsetright1
 165          * 函数功能                 : 向右偏移方式2
 166          *******************************************************************************/
 167          void offsetright1()     
 168          {
 169   1           left=36;
 170   1               right=0;
 171   1               left1=1;
 172   1               left2=0;
 173   1               right1=1;
 174   1               right2=0;
 175   1      }  
 176          /*******************************************************************************
 177          * 函 数 名         : stop
 178          * 函数功能                 : 暂停
 179          *******************************************************************************/
C51 COMPILER V9.01   PWM                                                                   07/09/2019 13:08:34 PAGE 4   

 180          void stop()                       
 181          {
 182   1           left=0;
 183   1               right=0;
 184   1               left1=0;
 185   1               left2=0;
 186   1               right1=0;
 187   1               right2=0;
 188   1      }  
 189          /*******************************************************************************
 190          * 函 数 名         : wentleft
 191          * 函数功能                 : 小车向左前方前进
 192          *******************************************************************************/
 193          void wentleft()   
 194          {
 195   1           left=34;
 196   1               right=45;
 197   1               left1=1;
 198   1               left2=0;
 199   1               right1=1;
 200   1               right2=0;
 201   1      }
 202          
 203          /*******************************************************************************
 204          * 函 数 名         : in1
 205          * 函数功能                 : 定时器中断1.控制左电机的速度
 206          *******************************************************************************/
 207          void in1() interrupt 1     
 208          {
 209   1              TH0=(65535-100)/256;
 210   1              TL0=(65535-100)%256;
 211   1              t1++;
 212   1              if(t1==400) {t1=0;}
 213   1              if(t1<left){ENB1=1;}   //左前电机
 214   1              else{ENB1=0;}
 215   1              if(t1<right) {ENA1=1;}   //左后电机
 216   1              else{ENA1=0;}
 217   1      }
 218          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    373    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
