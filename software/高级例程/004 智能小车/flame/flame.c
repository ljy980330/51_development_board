/*********************************************************************************************************
*名称：flame.c
*功能：风扇灭火功能所用到的函数
创建时间：2019/7/8
修改时间：2019/7/8
作者：黄彦钊
*********************************************************************************************************/

#include <STC12C5A.H>	
#include "pwm/pwm.h"  
#include "delay/delay.h"
#include "config.h"
sbit INT5=P0^0;	//电机驱动右边	 56xi 接细的蓝色
sbit INT6=P0^1;					 //白  接细的绿色
sbit INT7=P0^2;	//电机驱动左边	 //灰 接蓝色
sbit INT8=P0^3;					 //紫  接橙色
sbit fire=P3^2;	//定义火焰传感器的IO口
sbit fire2=P3^3;
	
/*******************************************************************************
* 函 数 名         : Int0Init
* 函数功能		   : 打开外部中断0
*******************************************************************************/
void Int0Init()						  
{
	//设置INT0
	IT0=1;//跳变沿出发方式（下降沿）
	EX0=1;//打开INT0的中断允许。	
	EA=1;//打开总中断	
}
	 
/*******************************************************************************
* 函 数 名         : Int1Init
* 函数功能		   : 打开外部中断1
*******************************************************************************/
void Int1Init()					  
{
	//设置INT1
	IT1=1;//跳变沿出发方式（下降沿）
	EX1=1;//打开INT1的中断允许。	
	EA=1;//打开总中断	
}
     
/*******************************************************************************
* 函 数 名         : fsopen
* 函数功能		   : 开风扇
*******************************************************************************/
void fsopen()	
{		
	INT7=0;
	INT6=1;
}	
  
/*******************************************************************************
* 函 数 名         : fsopen2
* 函数功能		   : 开风扇方式2
*******************************************************************************/
void fsopen2()
{		   
	INT7=1;
	INT8=0;
}	  
	  
/*******************************************************************************
* 函 数 名         : fssto
* 函数功能		   : 风扇停止
*******************************************************************************/
void fsstop()	 
{
	INT7=1;
	INT6=1;
}	
		  
/*******************************************************************************
* 函 数 名         : fsstop2
* 函数功能		   : 风扇停止方式2
*******************************************************************************/
void fsstop2()
{
	INT7=1;
	INT8=1;
}	  
	  
/*******************************************************************************
* 函 数 名         : Int0
* 函数功能		   : 外部中断0的中断函数
*******************************************************************************/
void Int0() interrupt 0		
{
	ET0 = 0;
    TR0 = 0;
	stop();
	while(fire==0)		   //当火焰传感器检测到火焰
	{
		fsopen();	   //开风扇
	    delay_ms(4500);			   
	} 
	delay_ms(2000);
	while(fire==0)		   //当火焰传感器检测到火焰
	{
		fsopen();	   //开风扇
	    delay_ms(4500);			   
	}
	fsstop();	  //风扇停
	ET0 = 1;
    TR0 = 1;
}  
	  
/*******************************************************************************
* 函 数 名         : Int1
* 函数功能		   : 外部中断1的中断函数
*******************************************************************************/
void Int1()	interrupt 2		
{

	ET0 = 0;
    TR0 = 0;
	stop();
	while(fire2==0)
	{
		fsopen2();
		delay_ms(4500);	
	}
	delay_ms(2000);
	while(fire2==0)
	{
		fsopen2();
		delay_ms(4500);	
	}
	fsstop2();
	ET0 = 1;
    TR0 = 1;
}