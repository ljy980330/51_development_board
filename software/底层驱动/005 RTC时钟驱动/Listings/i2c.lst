C51 COMPILER V9.00   I2C                                                                   07/15/2019 09:11:17 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN .\Objects\i2c.obj
COMPILER INVOKED BY: D:\单片机\C51\BIN\C51.EXE i2c\i2c.c BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\i2c.lst) OBJECT(.\Ob
                    -jects\i2c.obj)

line level    source

   1          /*********************************************************************************************************
   2          *名称：i2c.c
   3          *功能： i2c初始化以及信号发送和主从机应答
   4          创建时间：2019/7/5
   5          修改时间：2019/XX/XX
   6          作者：XXX
   7          **********************************************************************************************************
             -/
   8          
   9          #include "i2c.h"
  10          
  11          /*******************************************************************************
  12          * 函 数 名         : I2C_Init
  13          * 函数功能                 : i2c初始化
  14          *******************************************************************************/
  15          
  16          void I2C_Init() 
  17          {
  18   1              SCL = high;
  19   1              nop(1);
  20   1              SDA = high;
  21   1              nop(1);
  22   1      }
  23          
  24          
  25          /*******************************************************************************
  26          * 函 数 名         : I2C_Start
  27          * 函数功能                 : i2c起始信号
  28          *******************************************************************************/
  29          
  30          void I2C_Start()  
  31          {
  32   1              SDA = high;
  33   1              nop(1);
  34   1              SCL = high;
  35   1              nop(1);
  36   1              SDA = low;
  37   1              nop(1);
  38   1              SCL = low;
  39   1              nop(1);
  40   1      }
  41          
  42          
  43          /*******************************************************************************
  44          * 函 数 名         : I2C_Stop
  45          * 函数功能                 : i2c终止信号
  46          *******************************************************************************/
  47          
  48          void I2C_Stop()
  49          {
  50   1              SCL = low;
  51   1              nop(1);
  52   1              SDA = low;
  53   1              nop(1);
C51 COMPILER V9.00   I2C                                                                   07/15/2019 09:11:17 PAGE 2   

  54   1              SCL = high;
  55   1              nop(1);
  56   1              SDA = high;
  57   1              nop(1);
  58   1      }
  59          
  60          
  61          /*******************************************************************************
  62          * 函 数 名         : Write_I2C_Byte
  63          * 函数功能                 : 通过I2C总线写一个字节
  64          *******************************************************************************/
  65          
  66          void Write_I2C_Byte(uchar I2C_Byte)
  67          {
  68   1              uchar i;
  69   1      
  70   1              for(i=0;i<8;i++)
  71   1              {
  72   2                      if(I2C_Byte & 0x80)
  73   2                              SDA=high;
  74   2                      else
  75   2                              SDA=low;
  76   2      
  77   2                      SCL=high;
  78   2      
  79   2                      SCL=low;
  80   2      
  81   2                      I2C_Byte<<=1;
  82   2              }
  83   1              SDA=low;
  84   1              nop(1);
  85   1              SCL=high;
  86   1              nop(1);
  87   1              SCL=low;
  88   1      }
  89          
  90          
  91          
  92          /*******************************************************************************
  93          * 函 数 名         : Read_I2C_Byte
  94          * 函数功能                 : 读取一个字节
  95          *******************************************************************************/
  96          
  97          uchar Read_I2C_Byte()   
  98          {
  99   1         uchar i, j;
 100   1         uchar k = 0;
 101   1         SCL = low; 
 102   1         nop(1); 
 103   1         SDA = high;
 104   1         for (i=0; i<8; i++)
 105   1         {  
 106   2                      nop(1); 
 107   2                      SCL = high; 
 108   2                      nop(1);
 109   2              if(SCL == high) 
 110   2                              j = 1;
 111   2              else
 112   2                              j = 0;
 113   2              k = (k<<1)|j;
 114   2                      SCL = 0;
 115   2              }
C51 COMPILER V9.00   I2C                                                                   07/15/2019 09:11:17 PAGE 3   

 116   1              nop(1);
 117   1              return(k);
 118   1      }
 119          
 120          
 121          /*******************************************************************************
 122          * 函 数 名         : Clock
 123          * 函数功能                 : i2c总线时钟
 124          *******************************************************************************/
 125          
 126          void Clock()
 127          {
 128   1              uchar i = 0;
 129   1              SCL = high;
 130   1              nop(1);
 131   1              while((SDA == high) && (i < 255))
 132   1                      i++;
 133   1              SCL = low;
 134   1              nop(1);
 135   1      
 136   1      }        
 137          /*******************************************************************************
 138          * 函 数 名         : Ack_I2C
 139          * 函数功能                 : 发出应答或非应答信号
 140          *******************************************************************************/
 141          void Ack_I2C(bit a) 
 142          { 
 143   1              if(a==0) 
 144   1                      SDA=0; //在此发出应答或非应答信号 
 145   1              else 
 146   1                      SDA=1; 
 147   1              delay_us(3); 
 148   1              SCL=1; 
 149   1              delay_us(5); //时钟低电平周期大于4μs 
 150   1              SCL=0; //清时钟线，钳住I2C总线以便继续接收 
 151   1              delay_us(2); 
 152   1      }  
 153          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    275    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
