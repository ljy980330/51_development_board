/*********************************************************************************************************
*名称：i2c_set.c
*功能：	i2c初始化以及信号发送和主从机应答
创建时间：2019/7/5
修改时间：2019/XX/XX
作者：XXX
**********************************************************************************************************/

#include "i2c_set.h"

/*******************************************************************************
* 函 数 名         : I2C_Init
* 函数功能		   : i2c初始化
*******************************************************************************/

void I2C_Init()	
{
	SDA = high;
	_nop_();
	SCL = high;
	_nop_();
}


/*******************************************************************************
* 函 数 名         : I2C_Start
* 函数功能		   : i2c起始信号
*******************************************************************************/

void I2C_Start()  
{
	SCL = high;
	_nop_();
	SDA = high;
	_nop_();
	SDA = low;
	_nop_();
}


/*******************************************************************************
* 函 数 名         : I2C_Stop
* 函数功能		   : i2c终止信号
*******************************************************************************/

void I2C_Stop()
{
	SDA = low;
	_nop_();
	SCL = high;
	_nop_();
	SDA = high;
	_nop_();
}


/*******************************************************************************
* 函 数 名         : Master_ACK
* 函数功能		   : 主机发送应答
*******************************************************************************/

void Master_ACK(bit i)		
{
	SCL = low; 	// 拉低时钟总线允许SDA数据总线上的数据变化
	_nop_(); 	// 让总线稳定
	if (i)	 	//如果i = 1 那么拉低数据总线 表示主机应答
	{
		SDA = low;
	}
	else	 
	{
		SDA = high;	//发送非应答
	}
	_nop_();	//让总线稳定
	SCL = high;	//拉高时钟总线 让从机从SDA线上读走 主机的应答信号
	_nop_();
	SCL = low;	//拉低时钟总线， 占用总线继续通信
	_nop_();
	SDA = high;	//释放SDA数据总线。
	_nop_();
}


/*******************************************************************************
* 函 数 名         : Test_ACK
* 函数功能		   : 检测从机应答
*******************************************************************************/

bit Test_ACK()
{
	SCL = high;
	_nop_();
	if (SDA)
	{
		SCL = low;
		_nop_();
		I2C_Stop();
		return(0);
	}
	else
	{
		SCL = low;
		_nop_();
		return(1);
	}
}

