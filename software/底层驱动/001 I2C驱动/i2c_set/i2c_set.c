/*********************************************************************************************************
*名称：i2c_set.c
*功能：	i2c初始化以及信号发送和主从机应答
创建时间：2019/7/5
修改时间：2019/XX/XX
作者：XXX
**********************************************************************************************************/

#include "i2c_set.h"

/*******************************************************************************
* 函 数 名         : I2C_Init
* 函数功能		   : i2c初始化
*******************************************************************************/

void I2C_Init()	
{
	SCL = high;
	nop();
	SDA = high;
	nop();
}


/*******************************************************************************
* 函 数 名         : I2C_Start
* 函数功能		   : i2c起始信号
*******************************************************************************/

void I2C_Start()  
{
	SDA = high;
	nop();
	SCL = high;
	nop();
	SDA = low;
	nop();
	SCL = low;
	nop();
}


/*******************************************************************************
* 函 数 名         : I2C_Stop
* 函数功能		   : i2c终止信号
*******************************************************************************/

void I2C_Stop()
{
	SDA = low;
	nop();
	SCL = high;
	nop();
	SDA = high;
	nop();
}


/*******************************************************************************
* 函 数 名         : WriteByte
* 函数功能		   : 写入一个字节
*******************************************************************************/

void WriteByte(U8 j)  
{
	U8 i,temp;
   	temp = j;
   	for(i=0; i<8; i++)
   {
	   temp = temp<<1;
	   SCL = low;
	   nop();
	   SDA = CY;		//temp左移时，移出的值放入了CY中 CY:进位标志
	   nop();
	   SCL = high;		//待sda线上的数据稳定后，将scl拉高
	   nop();
   }
   SCL = low;
   nop();
   SDA = high;
   nop();
}


/*******************************************************************************
* 函 数 名         : ReadByte
* 函数功能		   : 读取一个字节
*******************************************************************************/

U8 ReadByte()   
{
   U8 i, j;
   U8 k = 0;
   SCL = low; 
   nop(); 
   SDA = high;
   for (i=0; i<8; i++)
   {  
		nop(); 
		SCL = high; 
		nop();
      	if(SCL == high) 
			j = 1;
      	else
			j = 0;
      	k = (k<<1)|j;
	  	SCL = 0;
	}
   	nop();
	return(k);
}


/*******************************************************************************
* 函 数 名         : Clock
* 函数功能		   : i2c总线时钟
*******************************************************************************/

void Clock()
{
	U8 i = 0;
	SCL = high;
	nop();
	while((SDA == high) && (i < 255))
		i++;
	SCL = low;
	nop();

}

