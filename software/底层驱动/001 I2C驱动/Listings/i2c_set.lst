C51 COMPILER V9.00   I2C_SET                                                               07/06/2019 10:26:08 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE I2C_SET
OBJECT MODULE PLACED IN i2c_set.obj
COMPILER INVOKED BY: D:\单片机\C51\BIN\C51.EXE i2c_set\i2c_set.c BROWSE DEBUG OBJECTEXTEND PRINT(.\i2c_set.lst) OBJECT(i
                    -2c_set.obj)

line level    source

   1          /*********************************************************************************************************
   2          *名称：i2c_set.c
   3          *功能： i2c初始化以及信号发送和主从机应答
   4          创建时间：2019/7/5
   5          修改时间：2019/XX/XX
   6          作者：XXX
   7          **********************************************************************************************************
             -/
   8          
   9          #include "i2c_set.h"
  10          
  11          /*******************************************************************************
  12          * 函 数 名         : I2C_Init
  13          * 函数功能                 : i2c初始化
  14          *******************************************************************************/
  15          
  16          void I2C_Init() 
  17          {
  18   1              SCL = high;
  19   1              nop();
*** WARNING C206 IN LINE 19 OF I2C_SET\I2C_SET.C: 'nop': missing function-prototype
  20   1              SDA = high;
  21   1              nop();
  22   1      }
  23          
  24          
  25          /*******************************************************************************
  26          * 函 数 名         : I2C_Start
  27          * 函数功能                 : i2c起始信号
  28          *******************************************************************************/
  29          
  30          void I2C_Start()  
  31          {
  32   1              SDA = high;
  33   1              nop();
  34   1              SCL = high;
  35   1              nop();
  36   1              SDA = low;
  37   1              nop();
  38   1              SCL = low;
  39   1              nop();
  40   1      }
  41          
  42          
  43          /*******************************************************************************
  44          * 函 数 名         : I2C_Stop
  45          * 函数功能                 : i2c终止信号
  46          *******************************************************************************/
  47          
  48          void I2C_Stop()
  49          {
  50   1              SDA = low;
  51   1              nop();
  52   1              SCL = high;
C51 COMPILER V9.00   I2C_SET                                                               07/06/2019 10:26:08 PAGE 2   

  53   1              nop();
  54   1              SDA = high;
  55   1              nop();
  56   1      }
  57          
  58          
  59          /*******************************************************************************
  60          * 函 数 名         : WriteByte
  61          * 函数功能                 : 写入一个字节
  62          *******************************************************************************/
  63          
  64          void WriteByte(U8 j)  
  65          {
  66   1              U8 i,temp;
  67   1              temp = j;
  68   1              for(i=0; i<8; i++)
  69   1         {
  70   2                 temp = temp<<1;
  71   2                 SCL = low;
  72   2                 nop();
  73   2                 SDA = CY;            //temp左移时，移出的值放入了CY中 CY:进位标志
  74   2                 nop();
  75   2                 SCL = high;          //待sda线上的数据稳定后，将scl拉高
  76   2                 nop();
  77   2         }
  78   1         SCL = low;
  79   1         nop();
  80   1         SDA = high;
  81   1         nop();
  82   1      }
  83          
  84          
  85          /*******************************************************************************
  86          * 函 数 名         : ReadByte
  87          * 函数功能                 : 读取一个字节
  88          *******************************************************************************/
  89          
  90          U8 ReadByte()   
  91          {
  92   1         U8 i, j;
  93   1         U8 k = 0;
  94   1         SCL = low; 
  95   1         nop(); 
  96   1         SDA = high;
  97   1         for (i=0; i<8; i++)
  98   1         {  
  99   2                      nop(); 
 100   2                      SCL = high; 
 101   2                      nop();
 102   2              if(SCL == high) 
 103   2                              j = 1;
 104   2              else
 105   2                              j = 0;
 106   2              k = (k<<1)|j;
 107   2                      SCL = 0;
 108   2              }
 109   1              nop();
 110   1              return(k);
 111   1      }
 112          
 113          
 114          /*******************************************************************************
C51 COMPILER V9.00   I2C_SET                                                               07/06/2019 10:26:08 PAGE 3   

 115          * 函 数 名         : Clock
 116          * 函数功能                 : i2c总线时钟
 117          *******************************************************************************/
 118          
 119          void Clock()
 120          {
 121   1              U8 i = 0;
 122   1              SCL = high;
 123   1              nop();
 124   1              while((SDA == high) && (i < 255))
 125   1                      i++;
 126   1              SCL = low;
 127   1              nop();
 128   1      
 129   1      }
 130          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    174    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
