C51 COMPILER V9.00   I2C_SET                                                               07/12/2019 14:26:34 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE I2C_SET
OBJECT MODULE PLACED IN .\Objects\i2c_set.obj
COMPILER INVOKED BY: D:\单片机\C51\BIN\C51.EXE i2c_set\i2c_set.c BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\i2c_set.lst)
                    - OBJECT(.\Objects\i2c_set.obj)

line level    source

   1          /*********************************************************************************************************
   2          *名称：i2c_set.c
   3          *功能： i2c初始化以及信号发送和主从机应答
   4          创建时间：2019/7/5
   5          修改时间：2019/XX/XX
   6          作者：XXX
   7          **********************************************************************************************************
             -/
   8          
   9          #include "i2c_set.h"
  10          
  11          /*******************************************************************************
  12          * 函 数 名         : IIC_Init
  13          * 函数功能                 : i2c初始化
  14          *******************************************************************************/
  15          
  16          void IIC_Init() 
  17          {
  18   1              SCL = high;
  19   1              nop();
  20   1              SDA = high;
  21   1              nop();
  22   1      }
  23          
  24          
  25          /*******************************************************************************
  26          * 函 数 名         : IIC_Start
  27          * 函数功能                 : i2c起始信号
  28          *******************************************************************************/
  29          
  30          void IIC_Start()  
  31          {
  32   1              SDA = high;
  33   1              nop();
  34   1              SCL = high;
  35   1              nop();
  36   1              SDA = low;
  37   1              nop();
  38   1              SCL = low;
  39   1              nop();
  40   1      }
  41          
  42          
  43          /*******************************************************************************
  44          * 函 数 名         : IIC_Stop
  45          * 函数功能                 : i2c终止信号
  46          *******************************************************************************/
  47          
  48          void IIC_Stop()
  49          {
  50   1              SCL = low;
  51   1              nop();
  52   1              SDA = low;
  53   1              nop();
C51 COMPILER V9.00   I2C_SET                                                               07/12/2019 14:26:34 PAGE 2   

  54   1              SCL = high;
  55   1              nop();
  56   1              SDA = high;
  57   1              nop();
  58   1      }
  59          
  60          
  61          /*******************************************************************************
  62          * 函 数 名         : Write_IIC_Byte
  63          * 函数功能                 : 通过I2C总线写一个字节
  64          *******************************************************************************/
  65          
  66          void Write_IIC_Byte(U8 IIC_Byte)
  67          {
  68   1              U8 i;
  69   1      
  70   1              for(i=0;i<8;i++)
  71   1              {
  72   2                      if(IIC_Byte & 0x80)
  73   2                              SDA=high;
  74   2                      else
  75   2                              SDA=low;
  76   2      
  77   2                      SCL=high;
  78   2      
  79   2                      SCL=low;
  80   2      
  81   2                      IIC_Byte<<=1;
  82   2              }
  83   1              SDA=low;
  84   1              nop();
  85   1              SCL=high;
  86   1              nop();
  87   1              SCL=low;
  88   1      }
  89          
  90          
  91          
  92          /*******************************************************************************
  93          * 函 数 名         : Read_IIC_Byte
  94          * 函数功能                 : 读取一个字节
  95          *******************************************************************************/
  96          
  97          U8 Read_IIC_Byte()   
  98          {
  99   1         U8 i, j;
 100   1         U8 k = 0;
 101   1         SCL = low; 
 102   1         nop(); 
 103   1         SDA = high;
 104   1         for (i=0; i<8; i++)
 105   1         {  
 106   2                      nop(); 
 107   2                      SCL = high; 
 108   2                      nop();
 109   2              if(SCL == high) 
 110   2                              j = 1;
 111   2              else
 112   2                              j = 0;
 113   2              k = (k<<1)|j;
 114   2                      SCL = 0;
 115   2              }
C51 COMPILER V9.00   I2C_SET                                                               07/12/2019 14:26:34 PAGE 3   

 116   1              nop();
 117   1              return(k);
 118   1      }
 119          
 120          
 121          /*******************************************************************************
 122          * 函 数 名         : Clock
 123          * 函数功能                 : i2c总线时钟
 124          *******************************************************************************/
 125          
 126          void Clock()
 127          {
 128   1              U8 i = 0;
 129   1              SCL = high;
 130   1              nop();
 131   1              while((SDA == high) && (i < 255))
 132   1                      i++;
 133   1              SCL = low;
 134   1              nop();
 135   1      
 136   1      }
 137          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    171    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
