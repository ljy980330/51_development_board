C51 COMPILER V9.00   I2C_SET                                                               07/05/2019 20:50:44 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE I2C_SET
OBJECT MODULE PLACED IN i2c_set.obj
COMPILER INVOKED BY: D:\单片机\C51\BIN\C51.EXE i2c_set\i2c_set.c BROWSE DEBUG OBJECTEXTEND PRINT(.\i2c_set.lst) OBJECT(i
                    -2c_set.obj)

line level    source

   1          /*********************************************************************************************************
   2          *名称：i2c_set.c
   3          *功能： i2c初始化以及信号发送和主从机应答
   4          创建时间：2019/7/5
   5          修改时间：2019/XX/XX
   6          作者：XXX
   7          **********************************************************************************************************
             -/
   8          
   9          #include "i2c_set.h"
  10          
  11          /*******************************************************************************
  12          * 函 数 名         : I2C_Init
  13          * 函数功能                 : i2c初始化
  14          *******************************************************************************/
  15          
  16          void I2C_Init() 
  17          {
  18   1              SDA = high;
  19   1              _nop_();
  20   1              SCL = high;
  21   1              _nop_();
  22   1      }
  23          
  24          
  25          /*******************************************************************************
  26          * 函 数 名         : I2C_Start
  27          * 函数功能                 : i2c起始信号
  28          *******************************************************************************/
  29          
  30          void I2C_Start()  
  31          {
  32   1              SCL = high;
  33   1              _nop_();
  34   1              SDA = high;
  35   1              _nop_();
  36   1              SDA = low;
  37   1              _nop_();
  38   1      }
  39          
  40          
  41          /*******************************************************************************
  42          * 函 数 名         : I2C_Stop
  43          * 函数功能                 : i2c终止信号
  44          *******************************************************************************/
  45          
  46          void I2C_Stop()
  47          {
  48   1              SDA = low;
  49   1              _nop_();
  50   1              SCL = high;
  51   1              _nop_();
  52   1              SDA = high;
  53   1              _nop_();
C51 COMPILER V9.00   I2C_SET                                                               07/05/2019 20:50:44 PAGE 2   

  54   1      }
  55          
  56          
  57          /*******************************************************************************
  58          * 函 数 名         : Master_ACK
  59          * 函数功能                 : 主机发送应答
  60          *******************************************************************************/
  61          
  62          void Master_ACK(bit i)          
  63          {
  64   1              SCL = low;      // 拉低时钟总线允许SDA数据总线上的数据变化
  65   1              _nop_();        // 让总线稳定
  66   1              if (i)          //如果i = 1 那么拉低数据总线 表示主机应答
  67   1              {
  68   2                      SDA = low;
  69   2              }
  70   1              else     
  71   1              {
  72   2                      SDA = high;     //发送非应答
  73   2              }
  74   1              _nop_();        //让总线稳定
  75   1              SCL = high;     //拉高时钟总线 让从机从SDA线上读走 主机的应答信号
  76   1              _nop_();
  77   1              SCL = low;      //拉低时钟总线， 占用总线继续通信
  78   1              _nop_();
  79   1              SDA = high;     //释放SDA数据总线。
  80   1              _nop_();
  81   1      }
  82          
  83          
  84          /*******************************************************************************
  85          * 函 数 名         : Test_ACK
  86          * 函数功能                 : 检测从机应答
  87          *******************************************************************************/
  88          
  89          bit Test_ACK()
  90          {
  91   1              SCL = high;
  92   1              _nop_();
  93   1              if (SDA)
  94   1              {
  95   2                      SCL = low;
  96   2                      _nop_();
  97   2                      I2C_Stop();
  98   2                      return(0);
  99   2              }
 100   1              else
 101   1              {
 102   2                      SCL = low;
 103   2                      _nop_();
 104   2                      return(1);
 105   2              }
 106   1      }
 107          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     69    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
C51 COMPILER V9.00   I2C_SET                                                               07/05/2019 20:50:44 PAGE 3   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
