C51 COMPILER V9.00   I2C_DATA                                                              07/05/2019 20:50:44 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE I2C_DATA
OBJECT MODULE PLACED IN i2c_data.obj
COMPILER INVOKED BY: D:\单片机\C51\BIN\C51.EXE i2c_data\i2c_data.c BROWSE DEBUG OBJECTEXTEND PRINT(.\i2c_data.lst) OBJEC
                    -T(i2c_data.obj)

line level    source

   1          /*********************************************************************************************************
   2          *名称：i2c_data.c
   3          *功能： i2c进行发送接收读取数据
   4          创建时间：2019/7/5
   5          修改时间：2019/XX/XX
   6          作者：XXX
   7          **********************************************************************************************************
             -/
   8          
   9          #include "i2c_data.h"
  10          
  11          /*******************************************************************************
  12          * 函 数 名         : I2C_send_byte
  13          * 函数功能                 : 发送一个字节
  14          *******************************************************************************/
  15          
  16          void I2C_send_byte(U8 byte)
  17          {
  18   1              U8 i;
  19   1              for(i = 0 ; i < 8 ; i++)
  20   1              {
  21   2                      SCL = low;
  22   2                      _nop_();
  23   2                      if (byte & 0x80)
  24   2                      {                               
  25   3                              SDA = high;     
  26   3                              _nop_();                                   
  27   3                      }                               
  28   2                      else
  29   2                      {
  30   3                              SDA = low;
  31   3                              _nop_();
  32   3                      }
  33   2                      SCL = high;
  34   2                      _nop_();
  35   2                      byte <<= 1;     // 0101 0100B 
  36   2              }
  37   1              SCL = low;
  38   1              _nop_();
  39   1              SDA = high;
  40   1              _nop_();
  41   1      }
  42          
  43          
  44          /*******************************************************************************
  45          * 函 数 名         : I2C_read_byte
  46          * 函数功能                 : 读取一个字节
  47          *******************************************************************************/
  48          
  49          U8 I2C_read_byte()
  50          {
  51   1              U8 dat,i;
  52   1              SCL = low;
  53   1              _nop_();
C51 COMPILER V9.00   I2C_DATA                                                              07/05/2019 20:50:44 PAGE 2   

  54   1              SDA = high;
  55   1              _nop_();
  56   1              for(i = 0 ; i < 8 ; i++)
  57   1              {
  58   2                      SCL = high;
  59   2                      _nop_();
  60   2                      if (SDA)                            
  61   2                      {
  62   3                               dat |= 0x01; //
  63   3                      }
  64   2                      else
  65   2                      {
  66   3                              dat &=  0xfe;   //1111 1110
  67   3                      }
  68   2                      _nop_();
  69   2                      SCL = low;
  70   2                      _nop_();
  71   2                      if(i < 7)
  72   2                      {
  73   3                              dat = dat << 1; 
  74   3                      }
  75   2              }
  76   1              return(dat);
  77   1      }
  78          
  79          
  80          /*******************************************************************************
  81          * 函 数 名         : I2C_TransmitData
  82          * 函数功能                 : 发送数据
  83          *******************************************************************************/
  84          
  85          bit I2C_TransmitData(U8 ADDR, DAT)
  86          {
  87   1              I2C_Start();
  88   1              I2C_send_byte(AT24C02_ADDR+0);
  89   1              if (!Test_ACK())
  90   1              {
  91   2                      return(0);
  92   2              }
  93   1              I2C_send_byte(ADDR); 
  94   1              if (!Test_ACK())
  95   1              {
  96   2                      return(0);
  97   2              }
  98   1              I2C_send_byte(DAT);
  99   1              if (!Test_ACK())
 100   1              {
 101   2                      return(0);
 102   2              }
 103   1              I2C_Stop();
 104   1              return(1);      
 105   1      }
 106          
 107          
 108          /*******************************************************************************
 109          * 函 数 名         : I2C_ReceiveData
 110          * 函数功能                 : 接收数据
 111          *******************************************************************************/
 112          
 113          U8 I2C_ReceiveData(U8 ADDR)
 114          {
 115   1              U8 DAT;
C51 COMPILER V9.00   I2C_DATA                                                              07/05/2019 20:50:44 PAGE 3   

 116   1              I2C_Start();
 117   1              I2C_send_byte(AT24C02_ADDR+0);
 118   1              if (!Test_ACK())
 119   1              {
 120   2                      return(0);
 121   2              }
 122   1              I2C_send_byte(ADDR);
 123   1              Master_ACK(0);
 124   1              I2C_Start();
 125   1              I2C_send_byte(AT24C02_ADDR+1);
 126   1              if (!Test_ACK())
 127   1              {
 128   2                      return(0);
 129   2              }
 130   1              DAT = I2C_read_byte();
 131   1              Master_ACK(0);
 132   1              I2C_Stop();
 133   1              return(DAT);    
 134   1      }
 135          
 136          
 137          
 138          
 139          
 140          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    183    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
