C51 COMPILER V9.00   TIMERINTERRUPT                                                        08/30/2019 17:21:23 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE TIMERINTERRUPT
OBJECT MODULE PLACED IN .\Objects\timerInterrupt.obj
COMPILER INVOKED BY: F:\workApp\Keil_v5\C51\BIN\C51.EXE timerInterrupt\timerInterrupt.c BROWSE DEBUG OBJECTEXTEND PRINT(
                    -.\Listings\timerInterrupt.lst) OBJECT(.\Objects\timerInterrupt.obj)

line level    source

   1          /*********************************************************************************************************
   2          *名称：timerInterrupt.c
   3          *功能：定时中断对应的函数
   4          创建时间：2019/7/5
   5          修改时间：2019/7/5
   6          作者：黄彦钊
   7          ********************************************************************************************************/
   8          #include "timerInterrupt.h"     
   9          #include "config.h"       
  10          #include "led/led.h"    
  11          uint time;
  12          /*********************************************************************************************************
  13          ** TMOD是八位定时器/计数器模式控制寄存器（TIMER/COUNTER MODE CONTROL REGISTER），其中低四位定义定时器/计数
             -器T0,高四位定义定时器/计数器T1
  14          **
  15          ** 配置定时器0模式（即配置低四位）：|GATE           |  C/T                  |    M1 | M0                                  |
  16          **                                                       0                     0      设置为定时模式     0    0         13位定时模式
  17          **                                       1 要求INT0脚为高  1      设置为计数模式     0    1             16位定时模式
  18          **                                                                                               1    0         8位自动装载模式
  19          **
  20          ** 配置定时器1模式（即配置高四位）： |GATE           |  C/T                  |    M1 | M0                                 |
  21          **                                                       0                     0      设置为定时模式     0    0         13位定时模式
  22          **                                       1 要求INT0脚为高  1      设置为计数模式     0    1             16位定时模式
  23          **                                                                                               1    0         8位自动装载模式
  24          ** 详细的介绍请参看文档STC12C5A60S2.pdf中定时器计数器的章节
  25          ** 本例程采用16位定时模式，TH0,TL0全用
  26          *********************************************************************************************************/
  27          
  28          
  29          /*******************************************************************************************************
  30          **函数：init
  31          **功能：定时器0初始化
  32          **********************************************************************************************************
             -*/
  33          void init()
  34          {
  35   1        TMOD = 0X01;  //设置定时器的工作方式                                             
  36   1              TH0 = (65536-FSCLK/12/20)/256;   //配置定时器的高8位
  37   1              TL0 = (65536-FSCLK/12/20)%256;   //配置定时器的低8位
  38   1              ET0 = 1;                                         //允许定时器0中断
  39   1              EA = 1;                                          //打开总中断EA和ET0、TR0全部置1后，如果计数器计数溢出就马上执行中断处理函数void time0() int
             -errupt 1 
  40   1              TR0 = 1;                                         //打开定时器，开始计数
  41   1      }
  42          
  43                  
  44          /*******************************************************************************
  45          * 函 数 名         : timer0
  46          * 函数功能                 : 定时器0程序
  47                                                   实现2秒定时，即每2秒就执行一次if里面的程序语句
  48          *******************************************************************************/ 
  49          
  50          void timer0() interrupt 1
  51          {
C51 COMPILER V9.00   TIMERINTERRUPT                                                        08/30/2019 17:21:23 PAGE 2   

  52   1              int i=0;
  53   1              TH0 = (65536-FSCLK/12/20)/256; //每一次进入中断都要给定时器赋值，以确定下一次进入中断的时间
  54   1              TL0 = (65536-FSCLK/12/20)%256;  
  55   1              time ++;
  56   1              if(time ==40)                           
  57   1              {
  58   2                      if(i==0)
  59   2                              led1(); 
  60   2                      if(i==1)
  61   2                              led2();
  62   2                      if(i==2)
  63   2                      {
  64   3                              i=0;
  65   3                              led3();
  66   3                      }
  67   2                      time = 0; 
  68   2                      i++;
  69   2              }               
  70   1      }
  71          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    147    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
