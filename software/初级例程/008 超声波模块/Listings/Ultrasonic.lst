C51 COMPILER V9.00   ULTRASONIC                                                            07/25/2019 22:18:56 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE ULTRASONIC
OBJECT MODULE PLACED IN .\Objects\Ultrasonic.obj
COMPILER INVOKED BY: F:\workApp\Keil_v5\C51\BIN\C51.EXE Ultrasonic\Ultrasonic.c BROWSE DEBUG OBJECTEXTEND PRINT(.\Listin
                    -gs\Ultrasonic.lst) OBJECT(.\Objects\Ultrasonic.obj)

line level    source

   1          //超声波模块程序
   2          //作者 ： Z H
   3          //时间 2015/11/29
   4          //Trig  = P2^0
   5          //Echo  = P3^2
   6          #include <STC12C5A.H>                     
   7          #include "config.h"      
   8          #include <led/led.h> 
   9          extern uchar LED[8];    //用于LED的8位显示缓存
  10          unsigned char code table[]={0x3f,0x06,0x5b,0x4f,0x66,
  11                                      0x6d,0x7d,0x07,0x7f,0x6f};                  //0-9的码表
  12                                  
  13          uint distance;
  14          uint test =0;           
  15          uint time = 0;
  16          uint timeH = 0;
  17          uint timeL = 0;
  18          uint succeed_flag;
  19           
  20           
  21          sbit dula=P2^0;         //段选信号的锁存器控 制
  22          sbit wela=P2^1;         //位选信号的锁存器控制
  23          sbit Trig  = P2^2;
  24          sbit Echo  = P3^2;
  25           
  26          //
  27          void delay(uint z)
  28          {
  29   1       uint x,y;
  30   1        for(x=z;x>0;x--)
  31   1        for(y=125;y>0;y--);
  32   1      }
  33          //
  34          void delay_20us()
  35           { 
  36   1          uchar a ;
  37   1          for(a=0;a<100;a++);
  38   1       }
  39          //***************************************************************
  40          //显示数据转换程序
  41          void display(uint temp) 
  42           { 
  43   1          uchar qian,ge,shi,bai;
  44   1              qian = temp/1000;
  45   1          bai=temp/100%10;
  46   1          shi=temp%100/10;  
  47   1          ge=temp%10;
  48   1              
  49   1              
  50   1              LED[1]=qian;
  51   1              LED[2]=bai;
  52   1              LED[3]=shi;
  53   1              LED[4]=ge;
  54   1              
C51 COMPILER V9.00   ULTRASONIC                                                            07/25/2019 22:18:56 PAGE 2   

  55   1       }       
  56           void init()
  57           {
  58   1          Trig=0;       //首先拉低脉冲输入引脚
  59   1          EA=1;         //打开总中断0 
  60   1          TMOD=0x10;    //定时器1，16位工作方式 
  61   1       }
  62           void run()
  63           {
  64   1              EA=0;           //关总中断
  65   1          Trig=1;         //超声波输入端
  66   1          delay_20us();   //延时20us
  67   1          Trig=0;         //产生一个20us的脉冲
  68   1          while(Echo==0); //等待Echo回波引脚变高电平
  69   1          succeed_flag=0; //清测量成功标志
  70   1          EA=1; 
  71   1          EX0=1;          //打开外部中断0
  72   1          TH1=0;          //定时器1清零
  73   1          TL1=0;          //定时器1清零
  74   1          TF1=0;          //计数溢出标志
  75   1          TR1=1;          //启动定时器1
  76   1          delay(20);      //等待测量的结果
  77   1          TR1=0;          //关闭定时器1
  78   1          EX0=0;          //关闭外部中断0
  79   1         if(succeed_flag==1)
  80   1         {   
  81   2            time=timeH*256+timeL;
  82   2            distance=time*0.172;  //厘米
  83   2            display(distance);
  84   2                LED4_Display ();
  85   2         }                         
  86   1        if(succeed_flag==0)
  87   1         {
  88   2            distance=0;                    //没有回波则清零
  89   2            test = !test;                  //测试灯变化
  90   2          }    
  91   1       }
  92          //***************************************************************
  93          //外部中断0，用做判断回波电平
  94          void exter()  interrupt 0   // 外部中断0是0号
  95           {   
  96   1           timeH =TH1;    //取出定时器的值
  97   1           timeL =TL1;    //取出定时器的值
  98   1           succeed_flag=1;//至成功测量的标志
  99   1           EX0=0;         //关闭外部中断
 100   1       }
 101          //****************************************************************
 102          //定时器1中断,用做超声波测距计时
 103          void timer1() interrupt 3  //
 104          {
 105   1           TH1=0;
 106   1           TL1=0;
 107   1       }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    291    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12       3
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.00   ULTRASONIC                                                            07/25/2019 22:18:56 PAGE 3   

   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
