C51 COMPILER V9.01   CHAOSHENGBO                                                           07/05/2019 11:43:21 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE CHAOSHENGBO
OBJECT MODULE PLACED IN ChaoShengBo.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ChaoShengBo\ChaoShengBo.c DEBUG OBJECTEXTEND PRINT(.\ChaoShengBo.lst) OBJEC
                    -T(ChaoShengBo.obj)

line level    source

   1          /*********************************************************************************************************
   2          *名称：ChaoShengBo.h
   3          *功能：超声波对应的函数
   4          创建时间：2019/7/5
   5          修改时间：2019/7/5
   6          作者：黄剑桥
   7          *********************************************************************************************************/
   8          #include "ChaoShengBo.h"
   9          unsigned int  time=0;
  10          unsigned int  timer=0;
  11          unsigned char posit=0;
  12          unsigned long S=0;
  13          bit      flag =0;
  14          /**************************************************************************
  15          * 函数名称： Count
  16          * 功能：     计算距离
  17          ******************************************************************************/
  18          void Conut()
  19          {
  20   1          time=TH0*256+TL0;
  21   1          TH0=0;
  22   1              TL0=0;
  23   1              
  24   1              S=(long)(time*0.17);     //算出来单位是CM
  25   1              if(S>=4000||flag==1)      //如果测量范围超出显示“----”
  26   1              {
  27   2                flag=0;
  28   2                disbuff[0]=10;           //“-”
  29   2                disbuff[1]=10;           //“-”
  30   2                disbuff[2]=10;           //“-”
  31   2                disbuff[3]=10;
  32   2              }
  33   1              else
  34   1              {
  35   2                disbuff[3]=S%10000/1000;
  36   2            disbuff[2]=S%1000/100;
  37   2                disbuff[1]=S%100/10;
  38   2                disbuff[0]=S%10/1;
  39   2              }
  40   1      }
  41          
  42          /**************************************************************************
  43          * 函数名称：time0
  44          * 功能：    中断0计算时器溢出，超出测距距离
  45          ******************************************************************************/
  46           void time0() interrupt 1
  47           {
  48   1          flag=1;     //溢出标志
  49   1      
  50   1       }
  51          
  52          /**************************************************************************
  53          * 函数名称：time1
  54          * 功能：    中断1用来定时扫描数码管和启动超声波模块
C51 COMPILER V9.01   CHAOSHENGBO                                                           07/05/2019 11:43:21 PAGE 2   

  55          ******************************************************************************/
  56          void time1() interrupt 3
  57          {
  58   1          TH1=0xf8;
  59   1              TL1=0x30;
  60   1              CsbDisplay();
  61   1              timer++;
  62   1              if(timer>=400)
  63   1              {
  64   2                timer=0;
  65   2                TX=1;                          //启动超声波模块
  66   2                _nop_(); 
  67   2                _nop_(); 
  68   2                _nop_(); 
  69   2                _nop_(); 
  70   2                _nop_(); 
  71   2                _nop_(); 
  72   2                _nop_(); 
  73   2                _nop_(); 
  74   2                _nop_(); 
  75   2                _nop_(); 
  76   2                _nop_(); 
  77   2                _nop_(); 
  78   2                _nop_(); 
  79   2                _nop_(); 
  80   2                _nop_(); 
  81   2                _nop_(); 
  82   2                _nop_();
  83   2                _nop_(); 
  84   2                _nop_(); 
  85   2                _nop_(); 
  86   2                _nop_();
  87   2                TX=0;
  88   2              }
  89   1              
  90   1      }
  91          
  92          /**************************************************************************
  93          * 函数名称：Initiali
  94          * 功能：    控制中断、定时器、超声波模块
  95          ******************************************************************************/
  96          void Initiali()
  97          {
  98   1          TMOD=0x11;             //设T0为方式1，GATE=1；
  99   1              TH0=0;
 100   1              TL0=0;          
 101   1              TH1=0xf8;                  //2MS定时
 102   1              TL1=0x30;
 103   1              ET0=1;             //允许T0中断
 104   1              ET1=1;                     //允许T1中断
 105   1              TR1=1;                     //开启定时器
 106   1              EA=1;                      //开启总中断
 107   1      
 108   1              while(1)
 109   1              {
 110   2               while(!RX);            //当RX为零时等待
 111   2               TR0=1;                     //开启计数
 112   2               while(RX);                     //当RX为1计数并等待
 113   2               TR0=0;                         //关闭计数
 114   2           Conut();                   //计算
 115   2         }
 116   1      }
C51 COMPILER V9.01   CHAOSHENGBO                                                           07/05/2019 11:43:21 PAGE 3   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    375    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
