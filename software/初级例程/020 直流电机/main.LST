C51 COMPILER V9.01   MAIN                                                                  07/06/2019 20:57:48 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: F:\KEIL4\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /****************************************************/
   2          /*模块0的PWM输出管脚为P1.3       模块1的PWM输出管脚为1.4*/
   3          /*              本程序使用的是模块0                                             */
   4          /*              将P1.3口接入ULN2003的IN口                                       */
   5          /*              电机的一根线接5V 一根接out口                            */
   6          /*              修改时间：2019/6/2                                              */
   7          /****************************************************/
   8          
   9          #include <STC12C5A.H>
  10          #include <intrins.h> 
  11          unsigned char CCAP[15]={0,2,5,8,16,32,45,64,88,100,128,150,180,220,240}; //用于调配占空比
  12          
  13          /************************************/
  14          /*
  15          /*              函数名：Init_PWM        
  16          /************************************/
  17          void Init_PWM()         //  PWM功能的初始化
  18          {
  19   1          CMOD = 0X02;        //  设置脉冲源   系统时钟2
  20   1       
  21   1          CCAPM0 = 0X42;      //  开启比较器，允许输出脉宽调制信号
  22   1          PCA_PWM0 = 0X00;    //  组成9位比较器
  23   1          CCAP0L = 0x80;      //  比较器中的初值
  24   1          CCAP0H = 0X80;      //  比较器初值
  25   1          CL=0;   //  装载值为0
  26   1          CR =1;  //  启动计数模式
  27   1      }
  28           
  29          
  30          /****************************************************/
  31          /*                   延时函数                       */
  32          /*              函数名：moto_delay80ms                                          */
  33          /****************************************************/  
  34          void moto_delay80ms()   //误差 -0.00000000001us
  35          {
  36   1          unsigned char a,b,c;
  37   1          for(c=58;c>0;c--)
  38   1              for(b=151;b>0;b--)
  39   1                  for(a=49;a>0;a--);
  40   1          _nop_();  //if Keil,require use intrins.h
  41   1      }
  42          
  43          
  44          
  45          
  46          /****************************************************/
  47          /*         赋值给CCAP0H用于改变占空比               */
  48          /*         函数名：PWM_change                                   */
  49          /****************************************************/
  50          void PWM_change()
  51          {
  52   1              int i;
  53   1              for(i=0;i<12;i++)
  54   1              {
  55   2                      CCAP0H=CCAP[i]; //
C51 COMPILER V9.01   MAIN                                                                  07/06/2019 20:57:48 PAGE 2   

  56   2                      moto_delay80ms();
  57   2              }
  58   1      
  59   1      }
  60          
  61          /************************************/
  62          /*
  63          /*                      主函数  
  64          /************************************/
  65          void main()
  66          {
  67   1          Init_PWM();//初始化PWM
  68   1              while(1)
  69   1              {
  70   2                      PWM_change(); //改变占空比从而改变输出电压
  71   2              }
  72   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     67    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
