C51 COMPILER V9.01   MAIN                                                                  07/07/2019 22:26:35 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: F:\KEIL4\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /****************************************************/
   2          /*模块0的PWM输出管脚为P1.3       模块1的PWM输出管脚为1.4*/
   3          /*      本程序使用的是模块0     用于直流电机                    */
   4          /*              将P1.3口接入ULN2003的IN口                                       */
   5          /*              电机的一根线接5V 一根接out口                            */
   6          /*              修改时间：2019年7月7日                                          */
   7          /*              作者：曾思茹                                                            */
   8          /****************************************************/
   9          
  10          #include <STC12C5A.H>
  11          #include <intrins.h> 
  12          unsigned char CCAP[15]={0,2,5,8,16,32,45,64,88,100,128,150,180,220,240}; //用于调配占空比
  13          
  14          
  15          /****************************************************/
  16          /*                              函数名：Init_PWM                                        */
  17          /*                                                                                                      */
  18          /****************************************************/
  19          
  20          void Init_PWM()         //  PWM功能的初始化
  21          {
  22   1          CMOD = 0X02;        //  设置脉冲源   系统时钟2
  23   1       
  24   1          CCAPM0 = 0X42;      //  开启比较器，允许输出脉宽调制信号
  25   1          PCA_PWM0 = 0X00;    //  组成9位比较器
  26   1          CCAP0L = 0x80;      //  比较器中的初值
  27   1          CCAP0H = 0X80;      //  比较器初值
  28   1          CL=0;   //  装载值为0
  29   1          CR =1;  //  启动计数模式
  30   1      }
  31           
  32          
  33          /*********************************************/
  34          /*      延时函数                                             */
  35          /*              函数名：moto_delay80ms                       */
  36          /*********************************************/  
  37          void moto_delay80ms()   //误差 -0.00000000001us
  38          {
  39   1          unsigned char a,b,c;
  40   1          for(c=58;c>0;c--)
  41   1              for(b=151;b>0;b--)
  42   1                  for(a=49;a>0;a--);
  43   1          _nop_();  //if Keil,require use intrins.h
  44   1      }
  45          
  46          
  47          
  48          
  49          /**********************************************/
  50          /*         赋值给CCAP0H用于改变占空比         */
  51          /*         函数名：PWM_change                         */
  52          /**********************************************/
  53          void PWM_change()
  54          {
  55   1              int i;
C51 COMPILER V9.01   MAIN                                                                  07/07/2019 22:26:35 PAGE 2   

  56   1              for(i=0;i<12;i++)
  57   1              {
  58   2                      CCAP0H=CCAP[i]; //
  59   2                      moto_delay80ms();
  60   2              }
  61   1      
  62   1      }
  63          
  64          /************************************/
  65          /*                      主函数                                  */
  66          /************************************/
  67          void main()
  68          {
  69   1          Init_PWM();//初始化PWM
  70   1              while(1)
  71   1              {
  72   2                      PWM_change(); //改变占空比从而改变输出电压
  73   2              }
  74   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     67    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
