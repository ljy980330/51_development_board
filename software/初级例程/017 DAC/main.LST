C51 COMPILER V9.01   MAIN                                                                  07/06/2019 21:05:28 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: F:\KEIL4\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          /****************************************************/
   3          
   4          /*                              该程序用于呼吸灯                                        */
   5          /*模块0的PWM输出管脚为P1.3       模块1的PWM输出管脚为1.4*/
   6          /*      修改时间：2019/6/2                                                              */
   7          
   8          /****************************************************/  
   9          #include <STC12C5A.H>
  10          unsigned char CCAP[10]={16,32,64,80,128,150,180,200,228,250}; //用于调配占空比
  11          
  12          
  13          
  14          /************************************/
  15          /*              函数名：Init_PWM
  16          /*      
  17          /************************************/
  18          
  19          void Init_PWM()         //  PWM功能的初始化
  20          {
  21   1          CMOD = 0X02;        //  设置脉冲源   系统时钟2
  22   1       
  23   1          CCAPM0 = 0X42;      //  开启比较器，允许输出脉宽调制信号
  24   1          PCA_PWM0 = 0X00;    //  组成9位比较器
  25   1          CCAP0L = 0x80;      //  比较器中的初值
  26   1          CCAP0H = 0X80;      //  比较器初值
  27   1          CL=0;   //  装载值为0
  28   1          CR =1;  //  启动计数模式
  29   1      }
  30           
  31          /****************************************************/
  32          /*                   延时函数                       */
  33          /*                      函数名：PWM_dalay                                               */
  34          /****************************************************/  
  35          void PWM_dalay()
  36          {
  37   1              int a=4000;
  38   1              while(--a);
  39   1              while(--a);
  40   1      /*之所以循环两次是因为延时时间不够转换速度太快现象会没那么明显*/
  41   1      }
  42          
  43          
  44          /****************************************************/
  45          /*         赋值给CCAP0H用于改变占空比               */
  46          /*          函数名：PWM_change                                  */
  47          /****************************************************/
  48          void PWM_change()
  49          {
  50   1              int i;
  51   1              for(i=0;i<10;i++)
  52   1              {
  53   2                      CCAP0H=CCAP[i]; //
  54   2                      PWM_dalay();
  55   2              }
C51 COMPILER V9.01   MAIN                                                                  07/06/2019 21:05:28 PAGE 2   

  56   1      
  57   1      }
  58          
  59          /************************************/
  60          /*
  61          /*                      主函数  
  62          /************************************/
  63          void main()
  64          {
  65   1          Init_PWM();//初始化PWM
  66   1              while(1)
  67   1              {
  68   2                      PWM_change(); //改变占空比从而改变输出电压
  69   2              }
  70   1      }
  71          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     76    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
